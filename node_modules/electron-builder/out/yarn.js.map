{
  "version": 3,
  "file": "yarn.js",
  "sourceRoot": "",
  "sources": [
    "../src/yarn.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import BluebirdPromise from \"bluebird-lst-c\"\nimport * as path from \"path\"\nimport { log } from \"./util/log\"\nimport { homedir } from \"os\"\nimport { spawn, exists, asArray } from \"./util/util\"\nimport { BuildMetadata } from \"./metadata\"\n\nexport async function installOrRebuild(options: BuildMetadata, appDir: string, electronVersion: string, arch: string, forceInstall: boolean = false) {\n  const args = computeExtraArgs(options)\n  if (forceInstall || !(await exists(path.join(appDir, \"node_modules\")))) {\n    await installDependencies(appDir, electronVersion, arch, args)\n  }\n  else {\n    await rebuild(appDir, electronVersion, arch, args)\n  }\n}\n\nexport function getGypEnv(electronVersion: string, arch: string) {\n  const gypHome = path.join(homedir(), \".electron-gyp\")\n  return Object.assign({}, process.env, {\n    npm_config_disturl: \"https://atom.io/download/electron\",\n    npm_config_target: electronVersion,\n    npm_config_runtime: \"electron\",\n    npm_config_arch: arch,\n    HOME: gypHome,\n    USERPROFILE: gypHome,\n  })\n}\n\nfunction computeExtraArgs(options: BuildMetadata) {\n  const args = asArray(options.npmArgs)\n  if (options.npmSkipBuildFromSource !== true) {\n    args.push(\"--build-from-source\")\n  }\n  return args\n}\n\nexport function installDependencies(appDir: string, electronVersion: string, arch: string = process.arch, additionalArgs: Array<string>): Promise<any> {\n  log(`Installing app dependencies for arch ${arch} to ${appDir}`)\n  let execPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const execArgs = [\"install\", \"--production\"]\n\n  const isYarn = isYarnPath(execPath)\n  if (!isYarn) {\n    if (process.env.NPM_NO_BIN_LINKS === \"true\") {\n      execArgs.push(\"--no-bin-links\")\n    }\n    execArgs.push(\"--cache-min\", \"999999999\")\n  }\n\n  if (execPath == null) {\n    execPath = getPackageToolPath()\n  }\n  else {\n    execArgs.unshift(execPath)\n    execPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  for (let a of additionalArgs) {\n    if (!isYarn || a !== \"--build-from-source\") {\n      execArgs.push(a)\n    }\n  }\n\n  return spawn(execPath, execArgs, {\n    cwd: appDir,\n    env: getGypEnv(electronVersion, arch),\n  })\n}\n\nlet readInstalled: any = null\nexport function dependencies(dir: string, extraneousOnly: boolean, result: Set<string>): Promise<Array<string>> {\n  if (readInstalled == null) {\n    readInstalled = BluebirdPromise.promisify(require(\"read-installed\"))\n  }\n  return readInstalled(dir)\n    .then((it: any) => flatDependencies(it, result, new Set(), extraneousOnly))\n}\n\nfunction flatDependencies(data: any, result: Set<string>, seen: Set<string>, extraneousOnly: boolean): void {\n  if (data.dependencies == null) {\n    return\n  }\n\n  const queue: Array<any> = [data.dependencies]\n  while (queue.length > 0) {\n    const deps = queue.pop()\n    for (let name of Object.keys(deps)) {\n      const dep = deps[name]\n      if (typeof dep !== \"object\" || (!extraneousOnly && dep.extraneous) || seen.has(dep)) {\n        continue\n      }\n\n      seen.add(dep)\n\n      if (extraneousOnly === dep.extraneous) {\n        result.add(dep.path)\n      }\n      else {\n        const childDeps = dep.dependencies\n        if (childDeps != null) {\n          queue.push(childDeps)\n        }\n      }\n    }\n  }\n}\n\nfunction getPackageToolPath() {\n  if (process.env.FORCE_YARN === \"true\") {\n    return process.platform === \"win32\" ? \"yarn.cmd\" : \"yarn\"\n  }\n  else {\n    return process.platform === \"win32\" ? \"npm.cmd\" : \"npm\"\n  }\n}\n\nfunction isYarnPath(execPath: string | null) {\n  return execPath != null && path.basename(execPath).startsWith(\"yarn\")\n}\n\nexport async function rebuild(appDir: string, electronVersion: string, arch: string = process.arch, additionalArgs: Array<string>) {\n  const deps = new Set<string>()\n  await dependencies(appDir, false, deps)\n  const nativeDeps = await BluebirdPromise.filter(deps, it => exists(path.join(it, \"binding.gyp\")), {concurrency: 8})\n\n  if (nativeDeps.length === 0) {\n    return\n  }\n\n  log(`Rebuilding native production dependencies for arch ${arch}`)\n\n  let execPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const execArgs: Array<string> = []\n  if (execPath == null) {\n    execPath = getPackageToolPath()\n  }\n  else {\n    execArgs.push(execPath)\n    execPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  const env = getGypEnv(electronVersion, arch)\n  if (isYarnPath(execPath)) {\n    execArgs.push(\"run\", \"install\", \"--\")\n    execArgs.push(\"--disturl=https://atom.io/download/electron\")\n    execArgs.push(`--target=${electronVersion}`)\n    execArgs.push(\"--runtime=electron\")\n    execArgs.push(`--arch=${arch}`)\n    execArgs.push(...additionalArgs)\n    await BluebirdPromise.each(nativeDeps, it => spawn(execPath, execArgs, {cwd: it, env: env}))\n  }\n  else {\n    execArgs.push(\"rebuild\")\n    execArgs.push(...additionalArgs)\n    execArgs.push(...nativeDeps.map(it => path.basename(it)))\n    await spawn(execPath, execArgs, {cwd: appDir, env: env})\n  }\n}"
  ]
}
